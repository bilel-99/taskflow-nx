<div class="container">
  <header class="header">
    <h1>{{ title }}</h1>
    <p class="subtitle">Gérez vos tâches efficacement</p>
  </header>

  <div class="stats">
    <div
      class="stat-card clickable"
      [class.active]="filterStatus === 'all'"
      (click)="setFilter('all')"
      (keydown.enter)="setFilter('all')"
      (keydown.space)="setFilter('all')"
      tabindex="0"
      role="button"
      [attr.aria-pressed]="filterStatus === 'all'"
    >
      <span class="stat-number">{{ tasks.length }}</span>
      <span class="stat-label">Tâches totales</span>
    </div>
    <div
      class="stat-card pending clickable"
      [class.active]="filterStatus === 'pending'"
      (click)="setFilter('pending')"
      (keydown.enter)="setFilter('pending')"
      (keydown.space)="setFilter('pending')"
      tabindex="0"
      role="button"
      [attr.aria-pressed]="filterStatus === 'pending'"
    >
      <span class="stat-number">{{ pendingTasks.length }}</span>
      <span class="stat-label">En cours</span>
    </div>
    <div
      class="stat-card completed clickable"
      [class.active]="filterStatus === 'completed'"
      (click)="setFilter('completed')"
      (keydown.enter)="setFilter('completed')"
      (keydown.space)="setFilter('completed')"
      tabindex="0"
      role="button"
      [attr.aria-pressed]="filterStatus === 'completed'"
    >
      <span class="stat-number">{{ completedTasks.length }}</span>
      <span class="stat-label">Terminées</span>
    </div>
  </div>

  <div class="actions">
    <button class="btn-primary" (click)="toggleForm()">
      {{ showForm ? 'Annuler' : '+ Nouvelle tâche' }}
    </button>
  </div>

  @if (showForm) {
  <div class="form-container">
    <h2>{{ isEditMode ? 'Modifier la tâche' : 'Créer une nouvelle tâche' }}</h2>
    <form (ngSubmit)="createTask()" #taskForm="ngForm">
      <div class="form-group">
        <label for="title">Titre *</label>
        <input
          type="text"
          id="title"
          name="title"
          [(ngModel)]="newTask.title"
          required
          placeholder="Titre de la tâche"
        />
      </div>

      <div class="form-group">
        <label for="description">Description *</label>
        <textarea
          id="description"
          name="description"
          [(ngModel)]="newTask.description"
          required
          rows="4"
          placeholder="Description détaillée de la tâche"
        ></textarea>
      </div>

      <div class="form-group">
        <label for="dueDate">Date d'échéance *</label>
        <input
          type="date"
          id="dueDate"
          name="dueDate"
          [(ngModel)]="newTask.dueDate"
          required
        />
      </div>

      <button type="submit" class="btn-primary" [disabled]="!taskForm.valid">
        {{ isEditMode ? 'Enregistrer les modifications' : 'Créer la tâche' }}
      </button>
    </form>
  </div>
  }

  <div class="tasks-section">
    @if (filteredTasks.length > 0) {
    <div class="tasks-list">
      @for (task of filteredTasks; track task.id) {
      <lib-task-card
        [task]="task"
        (toggleComplete)="toggleTaskCompletion($event)"
        (deleteTask)="deleteTask($event)"
        (editTask)="openEditForm($event)"
      ></lib-task-card>
      }
    </div>
    } @if (filteredTasks.length === 0 && tasks.length > 0) {
    <div class="empty-state">
      <p>Aucune tâche dans cette catégorie</p>
    </div>
    } @if (tasks.length === 0) {
    <div class="empty-state">
      <p>Aucune tâche pour le moment</p>
      <p class="empty-hint">Cliquez sur "Nouvelle tâche" pour commencer</p>
    </div>
    }
  </div>
</div>

<router-outlet></router-outlet>
